<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - FaceLog</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Chart Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at center, #103865, #091432 70%);
      color: #ffffff;
    }

    .sidebar {
      width: 250px;
      background-color: #052659;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      padding: 30px 20px;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .sidebar h2 {
      color: #84C8FC;
      text-align: center;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
    }

    .sidebar ul li {
      padding: 10px;
      margin-bottom: 10px;
      background-color: #103865;
      color: #ffffff;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: background 0.3s;
    }

    .sidebar ul li:hover {
      background-color: #0b3e6f;
    }

    .main-content {
      margin-left: 270px;
      padding: 30px;
      min-height: 100vh;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .top-bar h3 {
      color: #84C8FC;
    }

    .cards {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      margin-bottom: 30px;
    }

    .card-box {
      background-color: transparent;
      padding: 30px;
      border-radius: 10px;
      flex: 1;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      text-align: center;
      transition: transform 0.3s ease;
      min-width: 250px;
    }

    .card-box:hover {
      transform: translateY(-5px);
    }

    .card-box h4 {
      color: #ffffff;
      margin-bottom: 10px;
    }

    .card-box span {
      color: #84C8FC;
      font-size: 2rem;
      font-weight: bold;
    }

    canvas {
      width: 100% !important;
      height: auto !important;
    }

    #barChart {
      width: 100%;
      margin-top: 20px;
    }

    /* Subject Info Styling */
    .subject-section {
      padding: 40px 5%;
      background-color: #c9d0dd;
      border-radius: 10px;
    }

    .subject-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
    }

    .subject-card {
      flex: 0 1 calc(50% - 30px);
      background: linear-gradient(135deg, #052659, #114b8b);
      color: #fff;
      padding: 25px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .subject-card:hover {
      transform: translateY(-6px);
    }

    .subject-card h3 {
      margin-bottom: 15px;
      font-size: 24px;
    }

    .subject-card p {
      font-size: 18px;
      margin: 5px 0;
      color: #84C8FC;

    }

    /***student****/

    

    /***Attendance record section***/
    #attendance-section table tr:hover {
    background-color: #0c1d3b;
  }
  </style>
</head>

<body>

  <div class="sidebar">
    <h2>FaceLog</h2>
    <ul>
      <li><a href="#dashboard" style="color: #fff;text-decoration: none;">Dashboard</a></li>
      <li><a href="#subject" style="color: #fff;text-decoration: none;">Subjects</a></li>
      <li><a href="#student" style="color: #fff;text-decoration: none;">Student Registration</a></li>
      <li><a href="/logout" style="color: #fff; text-decoration: none;">Logout</a></li>

    </ul>
  </div>

  <div class="main-content" id="dashboard">
    <div class="top-bar">
      <h3>Dashboard Overview</h3>
      <div class="profile">Admin ▾</div>
    </div>

    <!-- Info Cards -->
    <div class="cards">
      <div class="card-box">
        <h4>Today Present</h4>
        <span>{{today_attendance}}</span>
      </div>
      <div class="card-box">
        <h4>Total Students Attended</h4>
        <span>{{total_students}}</span>
      </div>
      <div class="card-box">
        <h4>Total Subjects</h4>
        <span>{{total_subjects}}</span>
      </div>
    </div>

    <div class="cards">
      <div class="card-box">
        <h4>Recent Attendance</h4>
        <span><a href="#attendance-section" style="text-decoration: none;cursor: pointer; color: #84C8FC;" onclick="showAttendanceSection()">VIEW</a></span>



      </div>
      <div class="card-box">
        <h4>Manage Students</h4>
        <span><a href="#student" style="cursor: pointer; text-decoration: none;color: #84C8FC;">ADD</a></span>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="cards">
      <div class="card-box" style="flex: 2;">
        <h4>Subject-wise Attendance</h4>
        <canvas id="myPieChart"></canvas>
      </div>
      <div class="card-box" style="flex: 3;">
        <h4>Weekly Attendance</h4>
        <div id="barChart"></div>
      </div>
    </div>

    
<!-- Subject Info Section -->
<section class="subject-section" id="subject">
  <h2 style="text-align: center; font-size: 2.5rem; font-weight: bold; margin-bottom: 40px; color: #021323;">
    Subject Information</span>
  </h2>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 30px;">

    <!-- Subject Card -->
    <div style="background: #0e1e3a; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.3); display: flex; flex-direction: column; height: 100%;">
      <div style="height: 180px; background: url('https://tms-outsource.com/blog/wp-content/uploads/2024/04/web-technologies-800x500.jpg') center/cover;"></div>
      <div style="padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
        <h3 style="color: #84C8FC; margin-bottom: 15px;">Web Technology</h3>
        <div>
          <p style="color: #ffffff;">Total Classes: <b>50</b></p>
          <p style="color: #ffffff;">Classes Held: <b>{{ subject_classes["Web Technology"] }}</b></p>
        </div>
      </div>
    </div>

    <!-- Repeat for each subject card -->
    <div style="background: #0e1e3a; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.3); display: flex; flex-direction: column; height: 100%;">
      <div style="height: 180px; background: url('https://i.pinimg.com/736x/6c/2d/40/6c2d40e51b303afa827ba31f73b48223.jpg') center/cover;"></div>
      <div style="padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
        <h3 style="color: #84C8FC; margin-bottom: 15px;">Mathematics</h3>
        <div>
          <p style="color: #ffffff;">Total Classes: <b>50</b></p>
          <p style="color: #ffffff;">Classes Held: <b>{{ subject_classes["Mathematics"] }}</b></p>
        </div>
      </div>
    </div>

    <div style="background: #0e1e3a; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.3); display: flex; flex-direction: column; height: 100%;">
      <div style="height: 180px; background: url('https://media.licdn.com/dms/image/v2/D4D12AQHfc31H0ocxIg/article-cover_image-shrink_600_2000/article-cover_image-shrink_600_2000/0/1680786568189?e=2147483647&v=beta&t=vaYqf6dUFOesdPQ10OSiqnCtDK3sSzo2QLs1uqV69Gc') center/cover;"></div>
      <div style="padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
        <h3 style="color: #84C8FC; margin-bottom: 15px;">Artificial Intelligence</h3>
        <div>
          <p style="color: #ffffff;">Total Classes: <b>50</b></p>
          <p style="color: #ffffff;">Classes Held: <b>{{ subject_classes["Artificial Intelligence"] }}</b></p>
        </div>
      </div>
    </div>

    <div style="background: #0e1e3a; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.3); display: flex; flex-direction: column; height: 100%;">
      <div style="height: 180px; background: url('https://abctrainings.in/media/thumbnails/machine_learning.jpeg') center/cover;"></div>
      <div style="padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
        <h3 style="color: #84C8FC; margin-bottom: 15px;">Machine Learning</h3>
        <div>
          <p style="color: #ffffff;">Total Classes: <b>50</b></p>
          <p style="color: #ffffff;">Classes Held: <b>{{ subject_classes["Machine Learning"] }}</b></p>
        </div>
      </div>
    </div>

    <div style="background: #0e1e3a; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.3); display: flex; flex-direction: column; height: 100%;">
      <div style="height: 180px; background: url('https://www.witsdigital.com/wits_assets/blog/1577433743_cloud-computing.png') center/cover;"></div>
      <div style="padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
        <h3 style="color: #84C8FC; margin-bottom: 15px;">Cloud Computing</h3>
        <div>
          <p style="color: #ffffff;">Total Classes: <b>50</b></p>
          <p style="color: #ffffff;">Classes Held: <b>{{ subject_classes["Cloud Computing"] }}</b></p>
        </div>
      </div>
    </div>

    <div style="background: #0e1e3a; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.3); display: flex; flex-direction: column; height: 100%;">
      <div style="height: 180px; background: url('https://worldscholarshipforum.com/wp-content/uploads/2024/07/data-analytics-courses.jpg') center/cover;"></div>
        <div style="padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
          <h3 style="color: #84C8FC; margin-bottom: 15px;">Data Analytics</h3>
          <div>
            <p style="color: #ffffff;">Total Classes: <b>50</b></p>
            <p style="color: #ffffff;">Classes Held: <b>{{ subject_classes["Data Analytics"] }}</b></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

  
<!-- student section -->
<section id="student" class="student-section" style="margin-left: 270px; padding: 15px 2%;">
  <section style="background-color:#c9d0dd; padding: 50px 1%; border-radius: 10px;">
  <h2 style="text-align: center; font-size: 2.5rem; font-weight: bold; margin-bottom: 40px; color: #021323">
    Student Registration</span>
  </h2>

  <!-- Step Info Section -->
  <div style="max-width: 900px; width: 100%; margin: 0 auto 50px auto; background: radial-gradient(ellipse at center, #0a1a38 0%, #030b17 100%); padding: 50px 55px; border-radius: 20px; color: #ffffff; box-shadow: 0 10px 25px rgba(0,0,0,0.4); font-family: 'Poppins', sans-serif;">
    <h3 style="font-size: 1.6rem; color: #84C8FC; margin-bottom: 20px;">
      <i class="fas fa-chalkboard-teacher"></i> Student Registration Steps
    </h3>
    <p style="font-size: 1rem; line-height: 1.7; margin-bottom: 10px;">
      <strong>Step 1:</strong> Enter the student’s name and registration number in the form below.
    </p>
    <p style="font-size: 1rem; line-height: 1.7;">
      <strong>Step 2:</strong> Click <strong>“Start Face Recognition”</strong>. When the webcam opens, press <strong>SPACE</strong> to capture or <strong>ESC</strong> to cancel.
    </p>
  </div>

  <!-- Form Section -->
  <div style="max-width: 900px; width: 100%; margin: 0 auto; background: radial-gradient(ellipse at center, #0a1a38 0%, #030b17 100%); border-radius: 20px; padding: 60px 40px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);">
  <div style="background: transparent; color: #fff; font-family: 'Poppins', sans-serif;">
    <h3 style="font-size: 1.8rem; color: #84C8FC; margin-bottom: 25px; text-align: center;">
      <i class="fas fa-user-plus"></i> Add New Student
    </h3>

    <form action="/studentface" method="POST" style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
      <input type="text" id="sname" name="sname" placeholder="Student Name"
             required style="width: 70%; padding: 14px; border: none; border-radius: 8px; font-size: 1rem;" />
      <input type="text" id="rollno" name="rollno" placeholder="Registration Number"
             required style="width: 70%; padding: 14px; border: none; border-radius: 8px; font-size: 1rem;" />

      <button type="submit" 
        style="width: 70%; padding: 14px 0; background: #1871c5; color: #091432; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; transition: background 0.3s;">
        Add Face
      </button>
    </form>
  </div>
</div>
</section>
</section>

<!-- Attendance Section  -->
<section id="attendance-section" style="display: none; margin: 30px 25px 50px 300px;padding: 40px 2%; background-color: #c9d0dd; border-radius: 10px;">

  <h2 style="text-align: center; font-size: 2.5rem; font-weight: bold; margin-bottom: 30px; color: #021323;">
    Attendance Records
  </h2>

  <div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse; background-color: #021323; color: white; text-align: center; border-radius: 10px; overflow: hidden;">

      <thead style="background-color: #0f2a56;">
  <tr>
    <th style="padding: 12px; border: 1px solid #3a4e70;">Date</th>
    <th style="padding: 12px; border: 1px solid #3a4e70;">Reg No</th>
    <th style="padding: 12px; border: 1px solid #3a4e70;">Name</th>
    <th style="padding: 12px; border: 1px solid #3a4e70;">Subject Code</th>
    <th style="padding: 12px; border: 1px solid #3a4e70;">Date</th>
  </tr>
</thead>
<tbody>
  {% for record in attendance_data %}
  <tr>
    <td style="padding: 10px; border: 1px solid #3a4e70;">{{ record.date }}</td>
    <td style="padding: 10px; border: 1px solid #3a4e70;">{{ record.regno }}</td>
    <td style="padding: 10px; border: 1px solid #3a4e70;">{{ record.name }}</td>
    <td style="padding: 10px; border: 1px solid #3a4e70;">{{ record.subject_code}}</td>
    <td style="padding: 10px; border: 1px solid #3a4e70;">{{ record.date }}</td>
  </tr>
  {% endfor %}
</tbody>

    </table>
  </div>
  <div style="text-align: right; margin-bottom: 20px;">
    <button onclick="hideAttendanceSection()" style="margin-top: 5px;padding: 8px 16px; background-color: #0169b8; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">
      Read Less
    </button>
  </div>
</section>



 <!-- Custom Alert -->
<div id="customAlert" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center;">
  <div style="background:white; padding:30px 40px; border-radius:10px; text-align:center; max-width:400px;">
    <h2 style="color:#0c4680; margin-bottom:15px;">FaceLog</h2>
    <p id="alertMessage" style="font-size:1.1rem; color:#333;"></p>
    <button onclick="closeAlert()" style="margin-top:20px; padding:10px 20px; border:none; background:#022d58;
    color:white; font-weight:bold; border-radius:5px; cursor:pointer;">OK</button>
  </div>
</div>
<script>
    function closeAlert() {
      document.getElementById("customAlert").style.display = "none";
    }

    // Call manually if param exists in URL
    const faceParam = new URLSearchParams(window.location.search).get("face_saved");
    if (faceParam !== null) {
      showFaceAlert(faceParam === "true");
    }
  
<!-- Chart Scripts -->

  // ------------------ Doughnut Chart (Chart.js) ------------------
  const ctx = document.getElementById('myPieChart').getContext('2d');
  const pieData = {
    labels: {{ pie_labels | tojson }},
    datasets: [{
      data: {{ pie_values | tojson }},
      backgroundColor: ['#5fb2ff', '#ffaa5b', '#5ff9f9', '#9147ff', '#ff8fd9', '#3c2d91'],
      borderColor: '#0b0f38'
    }]
  };

  new Chart(ctx, {
    type: 'doughnut',
    data: pieData,
    options: {
      cutout: '50%',
      plugins: {
        legend: {
          position: 'right',
          labels: { color: 'white' }
        },
        tooltip: {
          callbacks: {
            label: ctx => `${ctx.label}: ${ctx.raw}`
          }
        }
      }
    }
  });

  // ------------------ Weekly Attendance Bar Chart (ApexCharts) ------------------
  const optionsBar = {
    series: [{
      name: 'Present',
      data: {{ attendance_counts | safe }}
    }],
    chart: {
      type: 'bar',
      height: 300,
      toolbar: { show: false }
    },
    xaxis: {
      categories: {{ week_labels | safe }},
      labels: {
        style: {
          colors: '#fff'
        }
      }
    },
    yaxis: {
      labels: {
        style: {
          colors: '#fff'
        }
      }
    },
    colors: ['#6aa9e9'],
    grid: {
      borderColor: '#2c3e50'
    },
    plotOptions: {
      bar: {
        borderRadius: 6,
        columnWidth: '50%'
      }
    },
    dataLabels: { enabled: false },
    tooltip: {
      custom: ({ series, dataPointIndex, w }) => `
        <div style="background-color:#1c3c6b;padding:10px;border-radius:8px;color:#fff;font-size:14px;">
          <strong>${w.globals.labels[dataPointIndex]}</strong><br/>Present: ${series[0][dataPointIndex]}
        </div>`
    }
  };

  new ApexCharts(document.querySelector("#barChart"), optionsBar).render();
  


  function showFaceAlert(success) {
    const message = success
      ? "Student Registered Successfully!"
      : "Registration Cancelled!";
    document.getElementById("alertMessage").innerText = message;
    document.getElementById("customAlert").style.display = "flex";
  }

  function closeAlert() {
    document.getElementById("customAlert").style.display = "none";
  }

  // Only run this if face_saved param exists in the URL
  (function () {
    const faceParam = new URLSearchParams(window.location.search).get("face_saved");
    if (faceParam !== null) {
      const success = faceParam === "true";
      showFaceAlert(success);
      
      const url = new URL(window.location);
      url.searchParams.delete("face_saved");
      window.history.replaceState({}, document.title, url.toString());
    }
  })();

  function showAttendanceSection() {
    document.getElementById("attendance-section").style.display = "block";
  }

  function hideAttendanceSection() {
    document.getElementById("attendance-section").style.display = "none";
  }


</script>  
</body>
</html>
